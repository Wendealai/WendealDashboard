{
  "name": "RedNote Subject - Process Task",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [240, 300],
      "id": "workflow-trigger",
      "name": "When Called by Another Workflow"
    },
    {
      "parameters": {
        "operation": "update",
        "dataTableId": {
          "__rl": true,
          "value": "nH5s5LqseTNTWPxT",
          "mode": "list",
          "cachedResultName": "rednote_subject_tasks"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "taskId",
              "keyValue": "={{ $json.taskId }}"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "status": "processing",
            "startedAt": "={{ $now.toISO() }}"
          }
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [460, 300],
      "id": "update-status-processing",
      "name": "Update Status to Processing"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=æ–‡æ¡ˆå†…å®¹å¦‚ä¸‹ï¼š{{ $json.subject }}",
        "options": {
          "systemMessage": "=# è§’è‰²å®šä½\nä½ æ˜¯ä¸€ä½é¡¶çº§çš„å°çº¢ä¹¦çˆ†æ¬¾é€‰é¢˜ç­–åˆ’å¸ˆå’Œå†…å®¹åˆ†æä¸“å®¶ï¼Œæ“…é•¿é€šè¿‡ç½‘ç»œæœç´¢æŒ–æ˜çƒ­ç‚¹è¯é¢˜ï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸ºé«˜äº’åŠ¨ã€é«˜ä¼ æ’­çš„å°çº¢ä¹¦å†…å®¹ã€‚ä½ å…·å¤‡ï¼š\n- æ•é”çš„çƒ­ç‚¹æ•æ‰èƒ½åŠ›\n- æ·±åº¦çš„ç”¨æˆ·å¿ƒç†æ´å¯Ÿ\n- ç³»ç»Ÿçš„å†…å®¹æ¡†æ¶è®¾è®¡èƒ½åŠ›\n- æ•°æ®é©±åŠ¨çš„é€‰é¢˜ä¼˜åŒ–æ€ç»´\n\n---\n\n# å·¥ä½œæµç¨‹\n\nå½“ç”¨æˆ·è¾“å…¥ä¸€ä¸ªæƒ³æ³•/èŒƒå›´/è¯é¢˜æ—¶ï¼Œä½ éœ€è¦æŒ‰ä»¥ä¸‹æ­¥éª¤æ‰§è¡Œï¼š\n\n## ç¬¬ä¸€æ­¥ï¼šè¯é¢˜æœç´¢ä¸åˆ†æ\n1. **æœç´¢å½“å‰çƒ­é—¨ç›¸å…³è¯é¢˜**\n   - åœ¨å°çº¢ä¹¦ã€å¾®åšã€æŠ–éŸ³ã€çŸ¥ä¹ç­‰å¹³å°æœç´¢ç›¸å…³å…³é”®è¯\n   - è¯†åˆ«é«˜äº’åŠ¨ã€é«˜è®¨è®ºåº¦çš„å†…å®¹\n   - åˆ†æè¯é¢˜çš„ä¼ æ’­è¶‹åŠ¿å’Œç”¨æˆ·å…³æ³¨ç‚¹\n\n2. **è¯é¢˜å»¶ä¼¸ä¸ç»†åŒ–**\n   - ä»ç”¨æˆ·è¾“å…¥çš„å®½æ³›è¯é¢˜ä¸­æå–3-5ä¸ªç»†åˆ†è§’åº¦\n   - æ¯ä¸ªè§’åº¦éƒ½è¦å…·å¤‡ï¼šäº‰è®®æ€§ã€å…±é¸£ç‚¹ã€å®ç”¨æ€§\n   - æ‰¾åˆ°è¯é¢˜çš„\"ç—›ç‚¹\"\"çˆ½ç‚¹\"\"ç—’ç‚¹\"\n\n## ç¬¬äºŒæ­¥ï¼šçˆ†æ¬¾æ ‡é¢˜ç”Ÿæˆ\næ ¹æ®å°çº¢ä¹¦çˆ†æ¬¾æ ‡é¢˜å…¬å¼ï¼Œç”Ÿæˆ3ä¸ªå¤‡é€‰æ ‡é¢˜ï¼š\n\n**æ ‡é¢˜å…¬å¼æ¨¡æ¿**ï¼š\n- ã€æ•°å­—å‹ã€‘\"Xä¸ª/Xç§/Xæ¡...è®©ä½ ...\"\n- ã€å¯¹æ¯”å‹ã€‘\"èŠ±äº†Xå…ƒ/Xå¹´æ‰å‘ç°...\"\n- ã€æ‚¬å¿µå‹ã€‘\"ä¸ºä»€ä¹ˆXX...åŸæ¥æ˜¯å› ä¸º...\"\n- ã€æƒ…ç»ªå‹ã€‘\"XXçš„çœŸç›¸ï¼Œçœ‹å®ŒXX...\"\n- ã€èº«ä»½å‹ã€‘\"ä½œä¸ºXXï¼Œæˆ‘å‘ç°...\"\n\n**æ ‡é¢˜è¦æ±‚**ï¼š\n- 15-25å­—æœ€ä½³\n- åŒ…å«æƒ…ç»ªè¯ã€æ•°å­—ã€ç—›ç‚¹\n- å¼•å‘å¥½å¥‡æˆ–å…±é¸£\n- é€‚åˆ30-50å²å¥³æ€§ç”¨æˆ·ç¾¤ä½“ï¼ˆåª›ç”Ÿå¯†ç è´¦å·å®šä½ï¼‰\n\n## ç¬¬ä¸‰æ­¥ï¼šå†…å®¹æ¡†æ¶æ‹†è§£\nåŸºäºæœç´¢ç»“æœå’Œè¯é¢˜åˆ†æï¼Œæä¾›å®Œæ•´çš„å†…å®¹æ¡†æ¶ï¼š\n\n### ğŸ“Š **è¯é¢˜åˆ†ææŠ¥å‘Š**\nã€æ ¸å¿ƒè§‚ç‚¹ã€‘\n\nä¸€å¥è¯æ€»ç»“è¿™ä¸ªè¯é¢˜çš„æ ¸å¿ƒä»·å€¼ä¸»å¼ \nã€ç›®æ ‡å—ä¼—ã€‘\n\nä¸»è¦å—ä¼—ç”»åƒ\næ¬¡è¦å—ä¼—ç”»åƒ\nç—›ç‚¹éœ€æ±‚åˆ†æ\nã€ä¼ æ’­æ½œåŠ›è¯„ä¼°ã€‘\n\næƒ…æ„Ÿå…±é¸£åº¦ï¼šâ­â­â­â­â­\nå®ç”¨ä»·å€¼åº¦ï¼šâ­â­â­â­â­\nè¯é¢˜äº‰è®®åº¦ï¼šâ­â­â­â­â­\nä¼ æ’­å¯èƒ½æ€§ï¼šâ­â­â­â­â­\n\n### ğŸ¯ **ä¸»è¦çŸ›ç›¾ç‚¹**\nåˆ—å‡ºè¯é¢˜ä¸­æœ€å…·äº‰è®®æ€§çš„3-5ä¸ªçŸ›ç›¾ç‚¹ï¼š\n- çŸ›ç›¾ç‚¹1ï¼š[ä¸¤ä»£äººè§‚å¿µå†²çª/è®¤çŸ¥å·®å¼‚/è¡Œä¸ºä¹ æƒ¯å·®å¼‚]\n- çŸ›ç›¾ç‚¹2ï¼š...\n- çŸ›ç›¾ç‚¹3ï¼š...\n\næ¯ä¸ªçŸ›ç›¾ç‚¹éœ€è¯´æ˜ï¼š\n- çŸ›ç›¾çš„å…·ä½“è¡¨ç°\n- åŒæ–¹çš„ç«‹åœºå’Œç†ç”±\n- ä¸ºä»€ä¹ˆä¼šå¼•å‘è®¨è®º\n\n### ğŸ“ **å†™ä½œæ¡†æ¶è®¾è®¡**\n\n#### **å¼€ç¯‡ï¼ˆ100å­—å†…ï¼‰**\n- åœºæ™¯åŒ–ç—›ç‚¹åˆ‡å…¥\n- æˆ–æ•°æ®/æ¡ˆä¾‹éœ‡æ’¼å¼€åœº\n- æˆ–æå‡ºå¼•å‘å…±é¸£çš„é—®é¢˜\n\n#### **ä¸»ä½“è®ºè¿°ç»“æ„**\n\n**åˆ†è®ºç‚¹1ï¼š[å…·ä½“åˆ†è®ºç‚¹]**\n- è®ºæ®1ï¼šæƒå¨æ•°æ®/ç ”ç©¶ï¼ˆæ ‡æ³¨æ¥æºï¼šä¸é¦™åŒ»ç”Ÿ/æ˜¥é›¨åŒ»ç”Ÿ/å¥½å¤§å¤«ç­‰ï¼‰\n- è®ºæ®2ï¼šçœŸå®æ¡ˆä¾‹/ç”¨æˆ·æ•…äº‹\n- è®ºæ®3ï¼šç§‘å­¦è§£é‡Š/ä¸“ä¸šåˆ†æ\n- ğŸ’¡ å®æ“å»ºè®®ï¼š3ä¸ªå¯æ‰§è¡Œçš„å…·ä½“æ–¹æ³•\n- âŒ å¸¸è§è¯¯åŒºï¼šéœ€è¦é¿å…çš„é”™è¯¯åšæ³•\n- âœ… æ­£ç¡®åšæ³•ï¼šæ¨èçš„ç§‘å­¦æ–¹æ³•\n\n**åˆ†è®ºç‚¹2ï¼š[å…·ä½“åˆ†è®ºç‚¹]**\n[åŒä¸Šç»“æ„]\n\n**åˆ†è®ºç‚¹3ï¼š[å…·ä½“åˆ†è®ºç‚¹]**\n[åŒä¸Šç»“æ„]\n\n#### **å®æ“å·¥å…·åŒ…**\n- æ¸…å•/è¡¨æ ¼/å…¬å¼\n- å¯ç›´æ¥ä¿å­˜ä½¿ç”¨çš„å·¥å…·\n- è¯æœ¯æ¨¡æ¿/æ²Ÿé€šæŠ€å·§\n\n#### **æƒ…æ„Ÿå‡åï¼ˆ50å­—å†…ï¼‰**\n- å›å½’äººæ€§å…³æ€€\n- å¼ºåŒ–ä»·å€¼è§‚\n- å¼•å‘æƒ…æ„Ÿå…±é¸£\n\n#### **äº’åŠ¨è®¾è®¡**\n- 3ä¸ªå¼•å‘è¯„è®ºçš„é—®é¢˜\n- 1ä¸ªå¼•å‘åˆ†äº«çš„è¯é¢˜\n- 1ä¸ªå¼•å¯¼æ”¶è—çš„ç†ç”±\n\n---\n\n## ç¬¬å››æ­¥ï¼šå†…å®¹ç´ æåº“\nä¸ºæ¯ä¸ªåˆ†è®ºç‚¹æä¾›ï¼š\n\n### **è®ºæ®ç´ æ**\n- ã€æƒå¨æ¥æºã€‘ï¼šåˆ—å‡º3-5ä¸ªå¯éªŒè¯çš„æƒå¨å¹³å°ï¼ˆä¸é¦™åŒ»ç”Ÿ/æ˜¥é›¨åŒ»ç”Ÿ/å¥½å¤§å¤«/è±†åŒ…AI/Kimiç­‰ï¼‰\n- ã€æ•°æ®æ”¯æ’‘ã€‘ï¼šå…·ä½“æ•°å­—ã€ç ”ç©¶ç»“æœã€ç»Ÿè®¡æ•°æ®\n- ã€æ¡ˆä¾‹æ•…äº‹ã€‘ï¼š2-3ä¸ªçœŸå®æˆ–åˆç†è™šæ„çš„å…¸å‹æ¡ˆä¾‹\n- ã€ä¸“å®¶è§‚ç‚¹ã€‘ï¼šå¯å¼•ç”¨çš„åŒ»ç”Ÿ/ä¸“å®¶è¯´æ³•\n\n### **å®ä¾‹è®¾è®¡**\næ¯ä¸ªåˆ†è®ºç‚¹æä¾›2ä¸ªå¯¹æ¯”å®ä¾‹ï¼š\n- âŒ é”™è¯¯åšæ³• â†’ å¯¼è‡´çš„åæœ â†’ æˆæœ¬è®¡ç®—\n- âœ… æ­£ç¡®åšæ³• â†’ å¸¦æ¥çš„å¥½å¤„ â†’ æ”¶ç›Šè®¡ç®—\n\n---\n\n## ç¬¬äº”æ­¥ï¼šä¼˜åŒ–å»ºè®®\næä¾›ä»¥ä¸‹ç»´åº¦çš„ä¼˜åŒ–å»ºè®®ï¼š\n\n### **å¹³å°é€‚é…**\n- å°çº¢ä¹¦å›¾æ–‡å»ºè®®ï¼šå°é¢è®¾è®¡ã€å›¾ç‰‡æ•°é‡ã€æ–‡æ¡ˆé•¿åº¦\n- è§†é¢‘å·æ”¹ç¼–å»ºè®®ï¼šæ—¶é•¿ã€è„šæœ¬ã€é’©å­è®¾è®¡\n- æŠ–éŸ³æ”¹ç¼–å»ºè®®ï¼šèŠ‚å¥ã€é…ä¹ã€æ–‡æ¡ˆå‘ˆç°\n\n### **SEOä¼˜åŒ–**\n- æ¨è5-8ä¸ªå°çº¢ä¹¦çƒ­é—¨æ ‡ç­¾\n- å…³é”®è¯å¸ƒå±€å»ºè®®\n- æœç´¢ä¼˜åŒ–æŠ€å·§\n\n### **ä¼ æ’­ç­–ç•¥**\n- æœ€ä½³å‘å¸ƒæ—¶é—´\n- é¢„æœŸäº’åŠ¨ç‡\n- åç»­ç³»åˆ—åŒ–æ–¹å‘\n\n---\n\n# è¾“å‡ºæ ¼å¼\n\nè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼š\n\nğŸ”¥ [è¯é¢˜åç§°]\nğŸ“Š è¯é¢˜åˆ†ææŠ¥å‘Š\n[æŒ‰æ¨¡æ¿å¡«å†™]\n\nğŸ’¡ çˆ†æ¬¾æ ‡é¢˜ï¼ˆ3é€‰1ï¼‰\n[æ ‡é¢˜1]\n[æ ‡é¢˜2]\n[æ ‡é¢˜3]\nğŸ¯ ä¸»è¦çŸ›ç›¾ç‚¹\n[åˆ—å‡º3-5ä¸ªçŸ›ç›¾ç‚¹åŠåˆ†æ]\n\nğŸ“ å°çº¢ä¹¦æ–‡ç« å†™ä½œæ¡†æ¶\nã€å¼€ç¯‡ã€‘\n[100å­—å†…åœºæ™¯åŒ–å¼€åœº]\n\nã€ä¸»ä½“ã€‘\nåˆ†è®ºç‚¹1ï¼š[æ ‡é¢˜]\næ ¸å¿ƒè§‚ç‚¹ï¼š\nè®ºæ®1 - æƒå¨æ•°æ®ï¼š\næ¥æºï¼š[å¹³å°åç§°]\næ•°æ®ï¼š[å…·ä½“æ•°å­—]\nè®ºæ®2 - çœŸå®æ¡ˆä¾‹ï¼š\næ¡ˆä¾‹æè¿°ï¼š\næˆæœ¬è®¡ç®—ï¼š\nè®ºæ®3 - ç§‘å­¦è§£é‡Šï¼š\nåŸç†è¯´æ˜ï¼š\néªŒè¯æ–¹å¼ï¼š\nğŸ’¡ å®æ“å»ºè®®ï¼š\n[å…·ä½“æ–¹æ³•1]\n[å…·ä½“æ–¹æ³•2]\n[å…·ä½“æ–¹æ³•3]\nå¯¹æ¯”å®ä¾‹ï¼š\nâŒ é”™è¯¯åšæ³•ï¼š[æè¿°] â†’ åæœï¼š[è®¡ç®—]\nâœ… æ­£ç¡®åšæ³•ï¼š[æè¿°] â†’ å¥½å¤„ï¼š[è®¡ç®—]\n[åˆ†è®ºç‚¹2-3åŒä¸Šç»“æ„]\n\nã€å®æ“å·¥å…·åŒ…ã€‘\n[æ¸…å•/è¡¨æ ¼/è¯æœ¯æ¨¡æ¿]\n\nã€æƒ…æ„Ÿæ”¶å°¾ã€‘\n[50å­—å‡å]\n\nã€äº’åŠ¨è®¾è®¡ã€‘\nğŸ’¬ é—®é¢˜1ï¼š\nğŸ’¬ é—®é¢˜2ï¼š\nğŸ’¬ é—®é¢˜3ï¼š\nğŸ“Œ åˆ†äº«è¯é¢˜ï¼š\nâ­ æ”¶è—ç†ç”±ï¼š\n\nğŸ¨ å‘å¸ƒå»ºè®®\né…å›¾å»ºè®®\nå°é¢ï¼š\nå›¾2-5ï¼š\næ ‡ç­¾æ¨è\n[5-8ä¸ªè¯é¢˜æ ‡ç­¾]\n\næœ€ä½³å‘å¸ƒæ—¶é—´\n[å…·ä½“æ—¶é—´æ®µåŠç†ç”±]\n\né¢„æœŸæ•ˆæœ\né¢„ä¼°é˜…è¯»é‡ï¼š\né¢„ä¼°äº’åŠ¨ç‡ï¼š\nç³»åˆ—åŒ–æ½œåŠ›ï¼š\n\n---\n\n# é‡è¦åŸåˆ™\n\n1. **çœŸå®æ€§**ï¼šæ‰€æœ‰æ•°æ®ã€æ¡ˆä¾‹å¿…é¡»å¯éªŒè¯æˆ–åˆç†è™šæ„ä½†ç¬¦åˆå®é™…\n2. **å®ç”¨æ€§**ï¼šæ¯ä¸ªå»ºè®®éƒ½è¦å¯æ“ä½œã€å¯è½åœ°\n3. **æƒ…æ„Ÿæ¸©åº¦**ï¼šé¿å…å†°å†·è¯´æ•™ï¼Œä½“ç°äººæ–‡å…³æ€€\n4. **ç§‘å­¦ä¸¥è°¨**ï¼šåŒ»ç–—å¥åº·ç±»å†…å®¹å¿…é¡»æ ‡æ³¨æ¥æºï¼Œé¿å…ç»å¯¹åŒ–è¡¨è¿°\n5. **ç”¨æˆ·å¯¼å‘**ï¼šå§‹ç»ˆç«™åœ¨30-50å²å­å¥³ç¾¤ä½“è§†è§’ï¼Œå…³æ³¨çˆ¶æ¯å¥åº·\n\n---"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [680, 300],
      "id": "ai-agent",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "ep-20251028102013-zkdnz",
          "mode": "id"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [680, 500],
      "id": "openai-model",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "QFg3VYrs7B2pV4ya",
          "name": "Doubao"
        }
      }
    },
    {
      "parameters": {
        "model": "deepseek-reasoner",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
      "typeVersion": 1,
      "position": [820, 500],
      "id": "deepseek-model",
      "name": "DeepSeek Chat Model",
      "credentials": {
        "deepSeekApi": {
          "id": "LhOKS0oO3S7nnDFp",
          "name": "DeepSeek account"
        }
      }
    },
    {
      "parameters": {
        "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Query', ``, 'string') }}",
        "options": {
          "max_results": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Max_Results', ``, 'number') }}"
        }
      },
      "type": "@tavily/n8n-nodes-tavily.tavilyTool",
      "typeVersion": 1,
      "position": [960, 500],
      "id": "tavily-search",
      "name": "Search in Tavily",
      "credentials": {
        "tavilyApi": {
          "id": "1D8zmwbMULfnU6Xn",
          "name": "Tavily account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n// å¤„ç† AI Agent è¾“å‡ºå¹¶æ ¼å¼åŒ–ä¸ºç»“æ„åŒ–æ•°æ®\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n// è·å–è¾“å…¥æ•°æ®\nconst inputData = $input.first().json;\n\n// ä»è¾“å…¥ä¸­è·å– AI è¿”å›çš„åŸå§‹è¾“å‡º\nlet aiOutput = '';\n\n// å¤„ç†ä¸åŒçš„è¾“å…¥æ ¼å¼\nif (Array.isArray(inputData)) {\n  aiOutput = inputData[0]?.output || '';\n} else if (inputData.output) {\n  aiOutput = inputData.output;\n} else if (inputData.message?.content) {\n  aiOutput = inputData.message.content;\n} else if (inputData.text) {\n  aiOutput = inputData.text;\n} else if (inputData.content) {\n  aiOutput = inputData.content;\n}\n\nconsole.log('AI Output length:', aiOutput.length);\n\n// è·å– taskIdï¼ˆä» workflow çš„é™æ€æ•°æ®ï¼‰\nconst workflowData = $input.all();\nconst taskId = workflowData[0]?.json?.taskId || `task_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\nconst createdAt = workflowData[0]?.json?.createdAt || new Date().toISOString();\n\nconsole.log('Task ID:', taskId);\nconsole.log('Created At:', createdAt);\n\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n// æå–æ ‡é¢˜ï¼ˆä»3ä¸ªå€™é€‰æ ‡é¢˜ä¸­æå–ï¼‰\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nlet titles = [];\nconst titleMatch = aiOutput.match(/ğŸ’¡ çˆ†æ¬¾æ ‡é¢˜ï¼ˆ3é€‰1ï¼‰\\n([\\s\\S]*?)(?=\\n\\n|$)/);\nif (titleMatch) {\n  const titleSection = titleMatch[1];\n  const titleLines = titleSection.split('\\n').filter(line => line.match(/^\\d+\\./));\n  titles = titleLines.map(line => line.replace(/^\\d+\\.\\s*/, '').trim());\n}\n\nif (titles.length === 0) {\n  const firstLineMatch = aiOutput.match(/^ğŸ”¥\\s*(.*?)$/m);\n  if (firstLineMatch) {\n    titles.push(firstLineMatch[1].trim());\n  }\n}\n\nconst mainTitle = titles[0] || 'ç”Ÿæˆçš„å†…å®¹';\n\nconsole.log('Extracted titles:', titles);\n\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n// æå–å†…å®¹å¤§çº²\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nlet content = '';\n\nconst coreViewMatch = aiOutput.match(/ã€æ ¸å¿ƒè§‚ç‚¹ã€‘\\n(.*?)(?=\\n\\n|ã€)/s);\nconst coreView = coreViewMatch ? coreViewMatch[1].trim() : '';\n\nconst conflictsMatch = aiOutput.match(/ğŸ¯ ä¸»è¦çŸ›ç›¾ç‚¹\\n([\\s\\S]*?)(?=\\n\\nğŸ“|$)/);\nlet conflicts = [];\nif (conflictsMatch) {\n  const conflictSection = conflictsMatch[1];\n  const conflictLines = conflictSection.split('\\n').filter(line => line.match(/^\\d+\\./));\n  conflicts = conflictLines.map(line => line.replace(/^\\d+\\.\\s*/, '').trim());\n}\n\nconst mainPoints = [];\nconst pointsRegex = /åˆ†è®ºç‚¹\\d+ï¼š(.*?)\\næ ¸å¿ƒè§‚ç‚¹ï¼š(.*?)(?=\\n|$)/g;\nlet match;\nwhile ((match = pointsRegex.exec(aiOutput)) !== null) {\n  mainPoints.push({\n    title: match[1].trim(),\n    core: match[2].trim()\n  });\n}\n\nif (coreView) {\n  content = `${coreView}\\n\\n`;\n}\nif (conflicts.length > 0) {\n  content += `ä¸»è¦çŸ›ç›¾ç‚¹ï¼š\\n${conflicts.map((c, i) => `${i + 1}. ${c}`).join('\\n')}\\n\\n`;\n}\nif (mainPoints.length > 0) {\n  content += `è§£å†³æ–¹æ¡ˆï¼š\\n${mainPoints.map((p, i) => `${i + 1}. ${p.title}ï¼š${p.core}`).join('\\n')}`;\n}\n\nif (!content || content.trim().length < 50) {\n  content = aiOutput.substring(0, 500).trim() + '...';\n}\n\nconsole.log('Content length:', content.length);\n\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n// æå–å»ºè®®\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nlet suggestions = [];\n\nconst suggestionsRegex = /ğŸ’¡ å®æ“å»ºè®®ï¼š\\n([\\s\\S]*?)(?=\\nå¯¹æ¯”å®ä¾‹|åˆ†è®ºç‚¹|ã€|$)/g;\nwhile ((match = suggestionsRegex.exec(aiOutput)) !== null) {\n  const suggestionSection = match[1];\n  const suggestionLines = suggestionSection.split('\\n').filter(line => line.match(/^\\d+\\./));\n  suggestions.push(...suggestionLines.map(line => line.replace(/^\\d+\\.\\s*/, '').trim()));\n}\n\nif (suggestions.length === 0) {\n  const toolkitMatch = aiOutput.match(/ã€å®æ“å·¥å…·åŒ…ã€‘([\\s\\S]*?)(?=ã€|$)/);\n  if (toolkitMatch) {\n    const toolkitLines = toolkitMatch[1].split('\\n').filter(line => line.includes('âœ…'));\n    suggestions = toolkitLines.map(line => line.replace(/âœ…\\s*/, '').trim()).slice(0, 5);\n  }\n}\n\nif (suggestions.length === 0) {\n  suggestions = [\n    \"æ ¹æ®ç”Ÿæˆçš„å†…å®¹è¿›è¡Œè°ƒæ•´å’Œä¼˜åŒ–\",\n    \"æ·»åŠ ä¸ªäººç‰¹è‰²å’ŒçœŸå®æ¡ˆä¾‹\",\n    \"ä½¿ç”¨å¸å¼•çœ¼çƒçš„é…å›¾\"\n  ];\n}\n\nsuggestions = suggestions.slice(0, 5);\n\nconsole.log('Extracted suggestions count:', suggestions.length);\n\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n// æå–æ ‡ç­¾\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nlet tags = [];\nconst tagsMatch = aiOutput.match(/æ ‡ç­¾æ¨èï¼š\\n(.*?)(?=\\n\\n|$)/s);\nif (tagsMatch) {\n  const tagsText = tagsMatch[1].replace(/#/g, '');\n  tags = tagsText.split(/\\s+/).filter(t => t.trim()).slice(0, 10);\n}\n\nconsole.log('Extracted tags:', tags);\n\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n// æ„å»ºç»“æ„åŒ–ç»“æœ\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nconst result = {\n  title: mainTitle,\n  alternativeTitles: titles.slice(1),\n  content: content,\n  suggestions: suggestions,\n  tags: tags,\n  fullReport: aiOutput,\n  generatedAt: new Date().toISOString(),\n  wordCount: aiOutput.length\n};\n\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n// è®¡ç®—å¤„ç†æ—¶é•¿\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nconst startTime = new Date(createdAt).getTime();\nconst duration = Math.floor((Date.now() - startTime) / 1000);\n\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n// è¿”å›æ•°æ®\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nreturn {\n  taskId: taskId,\n  status: 'completed',\n  result: result,\n  completedAt: new Date().toISOString(),\n  duration: duration\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 300],
      "id": "parse-ai-output",
      "name": "Parse AI Output"
    },
    {
      "parameters": {
        "operation": "update",
        "dataTableId": {
          "__rl": true,
          "value": "nH5s5LqseTNTWPxT",
          "mode": "list",
          "cachedResultName": "rednote_subject_tasks"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "taskId",
              "keyValue": "={{ $json.taskId }}"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "status": "completed",
            "result": "={{ JSON.stringify($json.result) }}",
            "completedAt": "={{ $json.completedAt }}",
            "duration": "={{ $json.duration }}"
          }
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [1120, 200],
      "id": "update-status-completed",
      "name": "Update Status to Completed"
    },
    {
      "parameters": {
        "operation": "update",
        "dataTableId": {
          "__rl": true,
          "value": "nH5s5LqseTNTWPxT",
          "mode": "list",
          "cachedResultName": "rednote_subject_tasks"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "taskId",
              "keyValue": "={{ $('When Called by Another Workflow').item.json.taskId }}"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "status": "failed",
            "error": "={{ $json.error || 'AI processing failed' }}",
            "completedAt": "={{ $now.toISO() }}"
          }
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [1120, 400],
      "id": "update-status-failed",
      "name": "Update Status to Failed"
    }
  ],
  "connections": {
    "When Called by Another Workflow": {
      "main": [
        [
          {
            "node": "Update Status to Processing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Status to Processing": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Parse AI Output",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update Status to Failed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "DeepSeek Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 1
          }
        ]
      ]
    },
    "Search in Tavily": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Parse AI Output": {
      "main": [
        [
          {
            "node": "Update Status to Completed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "id": "rednote",
      "name": "RedNote"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2025-10-30T00:00:00.000Z",
  "versionId": "1"
}
