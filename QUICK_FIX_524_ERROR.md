# ğŸš¨ 524 è¶…æ—¶é”™è¯¯å¿«é€Ÿä¿®å¤æŒ‡å—

## ğŸ¯ é—®é¢˜ç°è±¡

```
âŒ Status code: 524
âŒ CORS header 'Access-Control-Allow-Origin' missing
âŒ Subject Generation Failed
âŒ NetworkError when attempting to fetch resource
```

---

## ğŸ” é—®é¢˜æ ¹æº

å·¥ä½œæµ1çš„ `Execute Workflow` èŠ‚ç‚¹**æ­£åœ¨ç­‰å¾…å­å·¥ä½œæµå®Œæˆ**ï¼ˆ3-5åˆ†é’Ÿï¼‰ï¼Œå¯¼è‡´ï¼š

1. è¶…è¿‡ Cloudflare 100ç§’é™åˆ¶ â†’ 524 è¶…æ—¶
2. 524 å“åº”æ²¡æœ‰ CORS å¤´ â†’ æµè§ˆå™¨é˜»æ­¢
3. å‰ç«¯æ— æ³•è·å–å“åº” â†’ NetworkError

---

## âš¡ 3åˆ†é’Ÿå¿«é€Ÿä¿®å¤

### æ­¥éª¤ 1ï¼šæ‰“å¼€ n8n å·¥ä½œæµ1 (1åˆ†é’Ÿ)

1. è®¿é—®ï¼š`https://n8n.wendealai.com`
2. æ‰¾åˆ°å¹¶æ‰“å¼€ï¼š**æäº¤ä»»åŠ¡çš„å·¥ä½œæµ**ï¼ˆåŒ…å« `rednotesubject` webhook çš„ï¼‰
3. æ‰¾åˆ°èŠ‚ç‚¹ï¼š`Call 'RedNote Subject - Main workflow'` æˆ–ç±»ä¼¼åç§°

---

### æ­¥éª¤ 2ï¼šä¿®æ”¹é…ç½® (1åˆ†é’Ÿ)

1. ç‚¹å‡» `Execute Workflow` èŠ‚ç‚¹
2. å‘ä¸‹æ»šåŠ¨æ‰¾åˆ° **"Options"** éƒ¨åˆ†
3. å±•å¼€ Options
4. æ‰¾åˆ°ï¼š**"Wait For Sub-Workflow Completion"**
5. **å–æ¶ˆå‹¾é€‰**ï¼ˆæˆ–è®¾ç½®ä¸º `false`ï¼‰

#### è§†è§‰å‚è€ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Execute Workflow                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Workflow: [Main workflow â–¼]         â”‚
â”‚                                      â”‚
â”‚ â–¼ Options                            â”‚
â”‚   â˜ Wait For Sub-Workflow            â”‚  â† âš ï¸ å–æ¶ˆå‹¾é€‰è¿™ä¸ªï¼
â”‚     Completion                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

6. ç‚¹å‡» **"Save"** ä¿å­˜èŠ‚ç‚¹
7. ç‚¹å‡»å³ä¸Šè§’ **"Save"** ä¿å­˜å·¥ä½œæµ

---

### æ­¥éª¤ 3ï¼šéªŒè¯ä¿®å¤ (1åˆ†é’Ÿ)

#### æ–¹æ³•1ï¼šå‘½ä»¤è¡Œæµ‹è¯•

```bash
time curl -X POST https://n8n.wendealai.com/webhook/rednotesubject \
  -H "Content-Type: application/json" \
  -d '{"subject":"æµ‹è¯•","timestamp":"2025-10-30T10:00:00Z"}'
```

**é¢„æœŸç»“æœ**ï¼š

```json
{
  "taskId": "task_1730275200000_abc123",
  "status": "pending",
  ...
}
```

**å“åº”æ—¶é—´**ï¼š< 1ç§’ âœ…

---

#### æ–¹æ³•2ï¼šå‰ç«¯æµ‹è¯•

1. åˆ·æ–°æµè§ˆå™¨é¡µé¢
2. åœ¨ä¸»é¢˜è¾“å…¥æ¡†è¾“å…¥ï¼š`æµ‹è¯•ä¸»é¢˜`
3. ç‚¹å‡» **"Generate Subject"**

**é¢„æœŸè¡Œä¸º**ï¼š

- âœ… 1ç§’å†…æ˜¾ç¤ºï¼š`Task created (ID: ...)`
- âœ… è¿›åº¦æ¡å¼€å§‹ç§»åŠ¨
- âœ… çŠ¶æ€æ–‡æœ¬æ›´æ–°ï¼š`Processing... (Xs elapsed)`
- âœ… æ—  524 é”™è¯¯
- âœ… æ—  CORS é”™è¯¯

---

## ğŸ” å¦‚ä½•ç¡®è®¤ä¿®å¤æˆåŠŸ

### æ£€æŸ¥å·¥ä½œæµ1æ‰§è¡Œæ—¶é—´

1. åœ¨ n8n ä¸­æ‰“å¼€å·¥ä½œæµ1
2. ç‚¹å‡»å³ä¾§ **"Executions"** æ ‡ç­¾
3. æŸ¥çœ‹æœ€æ–°çš„æ‰§è¡Œè®°å½•
4. æ£€æŸ¥ **æ€»æ‰§è¡Œæ—¶é—´**

**ä¿®å¤å‰**ï¼š

```
æ€»æ‰§è¡Œæ—¶é—´: 100+ ç§’ âŒ
Call Workflow èŠ‚ç‚¹: 100+ ç§’ï¼ˆç­‰å¾…ä¸­ï¼‰
```

**ä¿®å¤å**ï¼š

```
æ€»æ‰§è¡Œæ—¶é—´: < 1 ç§’ âœ…
Call Workflow èŠ‚ç‚¹: < 0.1 ç§’ï¼ˆè§¦å‘åç«‹å³å®Œæˆï¼‰
```

---

## ğŸ“Š å·¥ä½œæµæ‰§è¡Œå¯¹æ¯”

### âŒ ä¿®å¤å‰ï¼ˆé”™è¯¯çŠ¶æ€ï¼‰

```
Webhook æ¥æ”¶è¯·æ±‚
    â†“
Generate Task ID
    â†“
Insert row
    â†“
Execute Workflow (â° ç­‰å¾… 3-5 åˆ†é’Ÿ...)
    â†“
ğŸ’¥ 100ç§’å Cloudflare è¶…æ—¶ï¼ˆ524ï¼‰
    â†“
Respond to Webhook (æ— æ³•æ‰§è¡Œ)
```

---

### âœ… ä¿®å¤åï¼ˆæ­£ç¡®çŠ¶æ€ï¼‰

```
Webhook æ¥æ”¶è¯·æ±‚
    â†“
Generate Task ID
    â†“
Insert row
    â”œâ”€ Execute Workflow (ğŸš€ ç«‹å³è§¦å‘ï¼Œä¸ç­‰å¾…)
    â””â”€ Respond to Webhook (âœ… < 1ç§’è¿”å› taskId)
```

---

## ğŸ¯ é…ç½®è¦ç‚¹

### Execute Workflow èŠ‚ç‚¹çš„å…³é”®é…ç½®

| é…ç½®é¡¹                               | é”™è¯¯å€¼           | æ­£ç¡®å€¼             |
| ------------------------------------ | ---------------- | ------------------ |
| **Wait For Sub-Workflow Completion** | âœ… true          | âŒ false           |
| **è¯´æ˜**                             | ç­‰å¾…å­å·¥ä½œæµå®Œæˆ | å¼‚æ­¥è§¦å‘ï¼Œç«‹å³è¿”å› |
| **ç»“æœ**                             | ğŸ’¥ 524 è¶…æ—¶      | âœ… ç«‹å³å“åº”        |

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šä»ç„¶å‡ºç° 524 é”™è¯¯

**å¯èƒ½åŸå› **ï¼š

1. Execute Workflow èŠ‚ç‚¹é…ç½®æœªä¿å­˜
2. å·¥ä½œæµæœªæ¿€æ´»
3. é…ç½®é”™è¯¯çš„èŠ‚ç‚¹ï¼ˆæ£€æŸ¥èŠ‚ç‚¹åç§°ï¼‰

**è§£å†³æ–¹æ³•**ï¼š

1. é‡æ–°æ£€æŸ¥ Execute Workflow èŠ‚ç‚¹çš„ Options
2. ç¡®è®¤ "Wait For Sub-Workflow" æ˜¯å¦å–æ¶ˆå‹¾é€‰
3. ä¿å­˜èŠ‚ç‚¹å’Œå·¥ä½œæµ
4. ç¡®è®¤å·¥ä½œæµçŠ¶æ€ä¸º "Active"

---

### é—®é¢˜ï¼šä»ç„¶å‡ºç° CORS é”™è¯¯

**å¯èƒ½åŸå› **ï¼š

1. Webhook èŠ‚ç‚¹æœªé…ç½® CORS
2. æµè§ˆå™¨ç¼“å­˜äº†æ—§çš„é”™è¯¯å“åº”

**è§£å†³æ–¹æ³•**ï¼š

1. æ£€æŸ¥ Webhook èŠ‚ç‚¹çš„ Options â†’ Allowed Origins æ˜¯å¦ä¸º `*`
2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆCtrl + Shift + Deleteï¼‰
3. ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•
4. é‡å¯æµè§ˆå™¨

---

### é—®é¢˜ï¼šå‰ç«¯ä»æ˜¾ç¤ºè¶…æ—¶

**å¯èƒ½åŸå› **ï¼š

1. å‰ç«¯ä»£ç æœªæ›´æ–°ï¼ˆä»ä½¿ç”¨åŒæ­¥å‡½æ•°ï¼‰
2. æµè§ˆå™¨æœªåˆ·æ–°

**è§£å†³æ–¹æ³•**ï¼š

1. ç¡®è®¤å‰ç«¯æŒ‰é’®ç»‘å®šçš„æ˜¯ `handleGenerateSubjectAsync`
2. ç¡¬åˆ·æ–°æµè§ˆå™¨ï¼ˆCtrl + Shift + Rï¼‰
3. æ£€æŸ¥å¼€å‘è€…å·¥å…· Console çš„æ—¥å¿—è¾“å‡º

---

## ğŸ“ å®Œæ•´é…ç½®æ£€æŸ¥æ¸…å•

### å·¥ä½œæµ1ï¼ˆæäº¤ä»»åŠ¡ï¼‰

- [ ] Webhook èŠ‚ç‚¹ CORS é…ç½®ä¸º `*`
- [ ] Execute Workflow èŠ‚ç‚¹ "Wait For Sub-Workflow" ä¸º `false`
- [ ] Respond to Webhook èŠ‚ç‚¹åœ¨æ­£ç¡®ä½ç½®
- [ ] å·¥ä½œæµå·²æ¿€æ´»
- [ ] æ‰§è¡Œæ—¶é—´ < 1ç§’

### å·¥ä½œæµ3ï¼ˆæŸ¥è¯¢çŠ¶æ€ï¼‰

- [ ] Webhook path ä¸º `task-status/:taskId`
- [ ] CORS é…ç½®ä¸º `*`
- [ ] å·¥ä½œæµå·²æ¿€æ´»

### å‰ç«¯

- [ ] æŒ‰é’®ç»‘å®š `handleGenerateSubjectAsync`
- [ ] è½®è¯¢ URL æ­£ç¡®ï¼š`/webhook/task-status/${taskId}`
- [ ] æµè§ˆå™¨å·²åˆ·æ–°

---

## ğŸ‰ ä¿®å¤å®Œæˆæ ‡å¿—

å½“æ‚¨çœ‹åˆ°ä»¥ä¸‹æƒ…å†µæ—¶ï¼Œè¯´æ˜ä¿®å¤æˆåŠŸï¼š

1. âœ… æäº¤ä»»åŠ¡å“åº”æ—¶é—´ < 1ç§’
2. âœ… å‰ç«¯æ”¶åˆ° taskId
3. âœ… è¿›åº¦æ¡å¼€å§‹ç§»åŠ¨
4. âœ… æ—  524 é”™è¯¯
5. âœ… æ—  CORS é”™è¯¯
6. âœ… çŠ¶æ€æ–‡æœ¬å®æ—¶æ›´æ–°
7. âœ… æœ€ç»ˆè·å–åˆ°å®Œæ•´ç»“æœ

---

## ğŸ†˜ ç´§æ€¥è”ç³»

å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼š

1. å¯¼å‡ºå·¥ä½œæµ1çš„ JSON é…ç½®
2. æ£€æŸ¥ `Execute Workflow` èŠ‚ç‚¹çš„ `options` éƒ¨åˆ†ï¼š
   ```json
   {
     "workflowId": "...",
     "options": {
       "waitForSubWorkflow": false  â† å¿…é¡»æ˜¯ false
     }
   }
   ```
3. æ£€æŸ¥ n8n æ‰§è¡Œæ—¥å¿—çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

---

**æœ€å…³é”®çš„ä¸€æ­¥**ï¼š**å–æ¶ˆå‹¾é€‰ "Wait For Sub-Workflow Completion"** âš ï¸

è¿™æ˜¯è§£å†³ 524 è¶…æ—¶çš„å”¯ä¸€æ–¹æ³•ï¼
