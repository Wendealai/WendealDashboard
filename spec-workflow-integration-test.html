<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spec-Workflowé›†æˆæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .code {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ… Spec-Workflowé›†æˆå®Œæˆ</h1>

        <div class="status success">
            âœ… Spec-Workflowè§„èŒƒå·²å®Œå…¨é›†æˆ
        </div>

        <div class="status success">
            âœ… Cloudflare Cookieé—®é¢˜å·²ä¿®å¤
        </div>

        <div class="status success">
            âœ… Webhookè¿æ¥æµ‹è¯•åŠŸèƒ½å·²æ·»åŠ 
        </div>

        <div class="section">
            <h2>ğŸ”§ Spec-Workflowè§„èŒƒå®ç°</h2>
            <div class="status info">
                <strong>æ ¸å¿ƒç‰¹æ€§</strong>:<br>
                â€¢ è§„èŒƒåŒ–çš„Payloadç»“æ„<br>
                â€¢ å·¥ä½œæµIDå’Œæ‰§è¡ŒIDè·Ÿè¸ª<br>
                â€¢ å®Œæ•´çš„å…ƒæ•°æ®æ”¯æŒ<br>
                â€¢ é‡è¯•æœºåˆ¶ï¼ˆ3æ¬¡é‡è¯•ï¼‰<br>
                â€¢ è¶…æ—¶æ§åˆ¶ï¼ˆ60ç§’ï¼‰
            </div>
            <div class="code">
// Spec-Workflow Payloadç»“æ„
{
  "workflowId": "tk-viral-extract-workflow",
  "executionId": "tk-exec-1757508270704-abc123def",
  "trigger": "manual",
  "timestamp": "2024-01-01T12:00:00.000Z",
  "parameters": {
    "keyword": "AIå·¥å…·",
    "offset": "0",
    "count": "20",
    "sortMethod": "0",
    "timeRange": "7"
  },
  "metadata": {
    "source": "tk-viral-extract",
    "version": "1.0.0",
    "userAgent": "Mozilla/5.0..."
  }
}
            </div>
        </div>

        <div class="section">
            <h2>ğŸ”§ Cloudflare CSPä¿®å¤</h2>
            <div class="status info">
                <strong>æ–°å¢åŸŸåæ”¯æŒ</strong>:<br>
                â€¢ <code>https://n8n.wendealai.com</code> - webhookç›®æ ‡åŸŸå<br>
                â€¢ <code>https://*.n8n.wendealai.com</code> - n8nå­åŸŸå<br>
                â€¢ ä¿æŒæ‰€æœ‰ç°æœ‰çš„CloudflareåŸŸåæ”¯æŒ
            </div>
            <div class="code">
// CSP connect-srcé…ç½®
"connect-src 'self' https://*.airtable.com https://*.stripe.com
  https://m.stripe.network https://js.stripe.com https://api.airtable.com
  wss://*.airtable.com https://airtable.com https://*.notion.so
  https://q.stripe.com https://*.cloudflare.com
  https://ping.cloudflare.com https://cloudflare.com
  https://*.ping.cloudflare.com https://*.notion.site
  wss://*.notion.site https://wendealau.notion.site
  https://n8n.wendealai.com https://*.n8n.wendealai.com"
            </div>
        </div>

        <div class="section">
            <h2>ğŸ”§ Webhookè¿æ¥æµ‹è¯•åŠŸèƒ½</h2>
            <div class="status info">
                <strong>æµ‹è¯•ç‰¹æ€§</strong>:<br>
                â€¢ ğŸ” æµ‹è¯•è¿æ¥æŒ‰é’®<br>
                â€¢ ğŸ“Š å®æ—¶è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨<br>
                â€¢ âœ… æˆåŠŸ/å¤±è´¥çŠ¶æ€åé¦ˆ<br>
                â€¢ ğŸ“¡ HEADè¯·æ±‚è¿æ¥æµ‹è¯•
            </div>
            <div class="code">
// è¿æ¥æµ‹è¯•æµç¨‹
1. ç‚¹å‡»"ğŸ” æµ‹è¯•è¿æ¥"æŒ‰é’®
2. å‘é€HEADè¯·æ±‚åˆ°webhookåœ°å€
3. æ˜¾ç¤ºè¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ï¼ˆç»¿ç¯/çº¢ç¯ï¼‰
4. æ˜¾ç¤ºæˆåŠŸ/å¤±è´¥æ¶ˆæ¯
            </div>
        </div>

        <div class="section">
            <h2>ğŸ”§ é‡è¯•å’Œé”™è¯¯å¤„ç†æœºåˆ¶</h2>
            <div class="status info">
                <strong>é”™è¯¯å¤„ç†ç­–ç•¥</strong>:<br>
                â€¢ 3æ¬¡è‡ªåŠ¨é‡è¯•<br>
                â€¢ 1ç§’é‡è¯•é—´éš”<br>
                â€¢ 60ç§’è¶…æ—¶<br>
                â€¢ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—<br>
                â€¢ ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
            </div>
            <div class="code">
// é‡è¯•é€»è¾‘ç¤ºä¾‹
for (let attempt = 1; attempt <= 3; attempt++) {
  try {
    const response = await fetch(webhookUrl, payload);
    if (response.ok) return success;
  } catch (error) {
    if (attempt === 3) return failure;
    await delay(1000); // ç­‰å¾…1ç§’åé‡è¯•
  }
}
            </div>
        </div>

        <div class="section">
            <h2>ğŸ¯ å·¥ä½œæµç¨‹</h2>
            <div class="code">
1. ğŸš€ ç”¨æˆ·å¡«å†™å‚æ•°å¹¶ç‚¹å‡»"æ‰§è¡Œ"
2. ğŸ“¡ å‘é€Spec-Workflowè§„èŒƒçš„POSTè¯·æ±‚
3. ğŸ”„ å¦‚æœå¤±è´¥ï¼Œè‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰
4. âœ… æˆåŠŸåæ˜¾ç¤ºæ‰§è¡ŒIDå’ŒæˆåŠŸæ¶ˆæ¯
5. ğŸ“Š ç”¨æˆ·å¯ä»¥åœ¨Notionæ–‡æ¡£ä¸­æŸ¥çœ‹ç»“æœ
6. ğŸ” å¯éšæ—¶ç‚¹å‡»"æµ‹è¯•è¿æ¥"æ£€æŸ¥webhookçŠ¶æ€
            </div>
        </div>

        <div class="status warning">
            âš ï¸ é‡è¦æé†’ï¼š<br>
            â€¢ ç¡®ä¿n8n webhookåœ°å€ <code>https://n8n.wendealai.com/webhook/tkextract</code> æ­£ç¡®é…ç½®<br>
            â€¢ é¦–æ¬¡ä½¿ç”¨æ—¶å»ºè®®å…ˆç‚¹å‡»"æµ‹è¯•è¿æ¥"éªŒè¯é…ç½®<br>
            â€¢ å¦‚æœè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œå’Œn8næœåŠ¡çŠ¶æ€
        </div>

        <div class="status success">
            ğŸ‰ Spec-Workflowé›†æˆå®Œæˆï¼ç°åœ¨å…·å¤‡ï¼š<br>
            â€¢ è§„èŒƒåŒ–çš„webhookè°ƒç”¨<br>
            â€¢ å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶<br>
            â€¢ å®æ—¶è¿æ¥çŠ¶æ€ç›‘æ§<br>
            â€¢ ä¼ä¸šçº§çš„å¯é æ€§ä¿éšœ
        </div>
    </div>
</body>
</html>

