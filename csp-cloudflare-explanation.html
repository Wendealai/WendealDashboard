<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSPä¸CloudflareæŠ€æœ¯è¯¦è§£</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .section {
            margin: 40px 0;
            padding: 25px;
            border-left: 5px solid #007bff;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .question {
            font-size: 18px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 15px;
        }
        .answer {
            font-size: 16px;
            margin-bottom: 15px;
        }
        .code {
            background: #f1f3f4;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            margin: 15px 0;
            border: 1px solid #e0e0e0;
            overflow-x: auto;
        }
        .important {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .architecture {
            background: #e8f4f8;
            border: 1px solid #b3e5fc;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .flow {
            background: #f0f9ff;
            border: 1px solid #b3e5fc;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .why-needed {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .alternative {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        h1 {
            color: #007bff;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #495057;
            margin-top: 30px;
        }
        h3 {
            color: #6c757d;
        }
        .highlight {
            background: #e3f2fd;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”’ CSPä¸CloudflareæŠ€æœ¯è¯¦è§£</h1>

        <div class="section">
            <div class="question">â“ ä»€ä¹ˆæ˜¯CSPï¼ˆContent Security Policyï¼‰ï¼Ÿ</div>
            <div class="answer">
                <strong>CSP</strong> æ˜¯ <span class="highlight">Content Security Policy</span> çš„ç¼©å†™ï¼Œä¸­æ–‡ç¿»è¯‘ä¸º"å†…å®¹å®‰å…¨ç­–ç•¥"ã€‚å®ƒæ˜¯ç°ä»£æµè§ˆå™¨æä¾›çš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºé˜²æ­¢æ¶æ„æ”»å‡»ã€‚
            </div>

            <div class="architecture">
                <h3>ğŸ—ï¸ CSPçš„æ¶æ„åŸç†</h3>
                <div class="code">
// CSPçš„å·¥ä½œåŸç†
æµè§ˆå™¨æ”¶åˆ°ç½‘é¡µæ—¶ï¼Œä¼šæ£€æŸ¥CSPå¤´éƒ¨ï¼š
"Content-Security-Policy: default-src 'self'; script-src 'self' https://trusted.com"

è¿™æ„å‘³ç€ï¼š
- é»˜è®¤åªå…è®¸åŒæºèµ„æº ('self')
- JavaScriptåªèƒ½ä»åŒæºæˆ–trusted.comåŠ è½½
- å¦‚æœæœ‰ä¸ç¬¦åˆè§„åˆ™çš„èµ„æºï¼Œä¼šè¢«æµè§ˆå™¨é˜»æ­¢
                </div>
            </div>

            <div class="important">
                <strong>ğŸ¯ CSPçš„æ ¸å¿ƒä½œç”¨ï¼š</strong><br>
                1. <strong>é˜²æ­¢XSSæ”»å‡»</strong> - é˜»æ­¢æ¶æ„è„šæœ¬æ³¨å…¥<br>
                2. <strong>é˜²æ­¢ä»£ç æ³¨å…¥</strong> - é™åˆ¶å¤–éƒ¨è„šæœ¬åŠ è½½<br>
                3. <strong>é˜²æ­¢æ•°æ®æ³„éœ²</strong> - æ§åˆ¶æ•°æ®å‘é€ç›®æ ‡<br>
                4. <strong>æå‡å®‰å…¨æ€§</strong> - æä¾›å¤šå±‚é˜²æŠ¤æœºåˆ¶
            </div>
        </div>

        <div class="section">
            <div class="question">ğŸŒ ä¸ºä»€ä¹ˆè¦ç”¨åˆ°Cloudflareçš„å†…å®¹ï¼Ÿ</div>
            <div class="answer">
                å› ä¸ºæˆ‘ä»¬åº”ç”¨ç¨‹åºä¸­åµŒå…¥äº† <strong>Notioné¡µé¢</strong>ï¼Œè€ŒNotionä½¿ç”¨äº†Cloudflareä½œä¸ºå…¶åŸºç¡€è®¾æ–½çš„ä¸€éƒ¨åˆ†ã€‚
            </div>

            <div class="architecture">
                <h3>ğŸ—ï¸ æˆ‘ä»¬çš„åº”ç”¨æ¶æ„</h3>
                <div class="flow">
                    <strong>ç”¨æˆ·è®¿é—®æµç¨‹ï¼š</strong><br>
                    1. ç”¨æˆ·æ‰“å¼€æˆ‘ä»¬çš„åº”ç”¨<br>
                    2. åº”ç”¨åŠ è½½TKViralExtractç»„ä»¶<br>
                    3. ç»„ä»¶åµŒå…¥Notioné¡µé¢<br>
                    4. Notioné¡µé¢éœ€è¦åŠ è½½Cloudflareçš„èµ„æº<br>
                    5. æµè§ˆå™¨æ£€æŸ¥CSPè§„åˆ™æ˜¯å¦å…è®¸<br>
                    6. å¦‚æœä¸å…è®¸ï¼Œä¼šé˜»æ­¢èµ„æºåŠ è½½å¹¶æŠ¥é”™
                </div>

                <div class="code">
// Cloudflareåœ¨Notionæ¶æ„ä¸­çš„ä½œç”¨
NotionæœåŠ¡å™¨ (AWS/Google Cloud)
    â†“
Cloudflare CDN (å…¨çƒåˆ†å‘ç½‘ç»œ)
    â†“
ç”¨æˆ·æµè§ˆå™¨ (æˆ‘ä»¬çš„åº”ç”¨)
                </div>
            </div>

            <div class="important">
                <strong>ğŸ”§ Cloudflareåœ¨Notionä¸­çš„å…·ä½“ä½œç”¨ï¼š</strong><br>
                â€¢ <strong>CDNåŠ é€Ÿ</strong> - å…¨çƒå†…å®¹åˆ†å‘ç½‘ç»œ<br>
                â€¢ <strong>DDoSé˜²æŠ¤</strong> - åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»é˜²æŠ¤<br>
                â€¢ <strong>SSLè¯ä¹¦</strong> - HTTPSåŠ å¯†å’Œè¯ä¹¦ç®¡ç†<br>
                â€¢ <strong>ç¼“å­˜ä¼˜åŒ–</strong> - é™æ€èµ„æºç¼“å­˜åŠ é€Ÿ<br>
                â€¢ <strong>å®‰å…¨è¿‡æ»¤</strong> - Webåº”ç”¨é˜²ç«å¢™(WAF)
            </div>
        </div>

        <div class="section">
            <div class="question">âš¡ è¿™äº›é…ç½®æ˜¯å¿…é¡»çš„å—ï¼Ÿ</div>
            <div class="answer">
                <strong>æ˜¯çš„ï¼Œè¿™äº›é…ç½®æ˜¯å¿…é¡»çš„</strong>ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åµŒå…¥Notioné¡µé¢æ¥æ˜¾ç¤ºTK Viral Extractçš„ç»“æœã€‚
            </div>

            <div class="why-needed">
                <h3>âœ… ä¸ºä»€ä¹ˆå¿…é¡»é…ç½®CSPï¼Ÿ</h3>
                <strong>æŠ€æœ¯åŸå› ï¼š</strong><br>
                â€¢ Notionçš„æ‰€æœ‰é™æ€èµ„æºï¼ˆJSã€CSSã€å›¾ç‰‡ï¼‰éƒ½é€šè¿‡Cloudflare CDNæä¾›<br>
                â€¢ Cloudflareä½¿ç”¨ç‰¹å®šçš„Cookieè¿›è¡Œä¼šè¯ç®¡ç†å’Œå®‰å…¨éªŒè¯<br>
                â€¢ å¦‚æœä¸é…ç½®CSPï¼Œæµè§ˆå™¨ä¼šé˜»æ­¢è¿™äº›èµ„æºï¼Œå¯¼è‡´Notioné¡µé¢æ— æ³•æ­£å¸¸åŠ è½½<br>
                â€¢ ç”¨æˆ·å°†çœ‹åˆ°ç©ºç™½é¡µé¢æˆ–é”™è¯¯æç¤ºï¼Œæ— æ³•æŸ¥çœ‹å·¥ä½œæµç»“æœ
            </div>

            <div class="code">
// å¦‚æœä¸é…ç½®CSPï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
æµè§ˆå™¨æ§åˆ¶å°ä¼šæ˜¾ç¤ºï¼š
"Content Security Policy: The page's settings blocked the loading of a resource at https://*.cloudflare.com/..."
"Notioné¡µé¢æ— æ³•åŠ è½½ï¼Œæ˜¾ç¤ºç©ºç™½æˆ–é”™è¯¯"

ç»“æœï¼šç”¨æˆ·æ— æ³•çœ‹åˆ°TK Viral Extractçš„å·¥ä½œæµç»“æœï¼
                </div>
            </div>

            <div class="alternative">
                <h3>ğŸ”„ æ›¿ä»£æ–¹æ¡ˆåˆ†æ</h3>
                <strong>å¦‚æœä¸æƒ³ä½¿ç”¨NotionåµŒå…¥ï¼Œæœ‰ä»¥ä¸‹æ›¿ä»£æ–¹æ¡ˆï¼š</strong><br>
                <br>
                <strong>æ–¹æ¡ˆ1ï¼šå®Œå…¨ç§»é™¤Notionæ˜¾ç¤º</strong><br>
                â€¢ ä¼˜ç‚¹ï¼šä¸éœ€è¦CSPé…ç½®ï¼Œåº”ç”¨æ›´è½»é‡<br>
                â€¢ ç¼ºç‚¹ï¼šç”¨æˆ·çœ‹ä¸åˆ°å·¥ä½œæµæ‰§è¡Œç»“æœ<br>
                <br>
                <strong>æ–¹æ¡ˆ2ï¼šä½¿ç”¨å…¶ä»–æ–‡æ¡£ç³»ç»Ÿ</strong><br>
                â€¢ ä¼˜ç‚¹ï¼šå¯èƒ½ä¸éœ€è¦Cloudflareä¾èµ–<br>
                â€¢ ç¼ºç‚¹ï¼šéœ€è¦é‡æ–°å¼€å‘æ˜¾ç¤ºç»„ä»¶<br>
                <br>
                <strong>æ–¹æ¡ˆ3ï¼šAPIé›†æˆè€ŒéåµŒå…¥</strong><br>
                â€¢ ä¼˜ç‚¹ï¼šæ›´å®‰å…¨ï¼Œæ€§èƒ½æ›´å¥½<br>
                â€¢ ç¼ºç‚¹ï¼šå¼€å‘å¤æ‚åº¦é«˜ï¼Œéœ€è¦Notion APIæƒé™
            </div>
        </div>

        <div class="section">
            <div class="question">ğŸ“‹ æˆ‘ä»¬çš„CSPé…ç½®è¯¦è§£</div>
            <div class="answer">
                è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬å½“å‰é…ç½®çš„å…·ä½“å†…å®¹å’Œä½œç”¨ï¼š
            </div>

            <div class="code">
// æˆ‘ä»¬çš„CSPé…ç½® (vite.config.ts)
{
  headers: {
    'Content-Security-Policy': [
      "default-src 'self' https:",
      "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://*.airtable.com https://*.stripe.com https://m.stripe.network https://js.stripe.com https://*.stripe.network https://airtable.com https://*.notion.so https://*.notion.site https://q.stripe.com https://*.cloudflare.com",
      "style-src 'self' 'unsafe-inline' https://*.airtable.com https://fonts.googleapis.com https://airtable.com https://*.notion.so https://*.notion.site https://*.cloudflare.com",
      "img-src 'self' data: https: blob: https://*.airtable.com https://*.stripe.com https://*.notion.so https://*.notion.site https://*.cloudflare.com",
      "font-src 'self' https://fonts.gstatic.com https://*.airtable.com https://airtable.com https://*.notion.so https://*.notion.site https://*.cloudflare.com",
      "connect-src 'self' https://*.airtable.com https://*.stripe.com https://m.stripe.network https://js.stripe.com https://api.airtable.com wss://*.airtable.com https://airtable.com https://*.notion.so https://q.stripe.com https://*.cloudflare.com https://ping.cloudflare.com https://cloudflare.com https://*.ping.cloudflare.com https://*.notion.site wss://*.notion.site https://wendealau.notion.site https://n8n.wendealai.com https://*.n8n.wendealai.com",
      "frame-src 'self' https://airtable.com https://*.airtable.com https://*.stripe.com https://m.stripe.network https://js.stripe.com https://*.notion.so https://*.notion.site",
      "object-src 'none'",
      "base-uri 'self'",
      "form-action 'self'",
      "upgrade-insecure-requests"
    ].join('; ')
  }
}
            </div>

            <div class="important">
                <strong>ğŸ” é…ç½®è§£è¯»ï¼š</strong><br>
                â€¢ <code>https://*.cloudflare.com</code> - Cloudflare CDNèµ„æº<br>
                â€¢ <code>https://*.notion.so</code> - Notionä¸»åŸŸå<br>
                â€¢ <code>https://*.notion.site</code> - Notionå­åŸŸå<br>
                â€¢ <code>https://wendealau.notion.site</code> - æ‚¨çš„å…·ä½“Notioné¡µé¢<br>
                â€¢ <code>https://n8n.wendealai.com</code> - WebhookæœåŠ¡
            </div>
        </div>

        <div class="section">
            <div class="question">ğŸš¨ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</div>

            <div class="important">
                <h3>â“ ä¸ºä»€ä¹ˆä¼šå‡ºç°Cookieæ‹’ç»é”™è¯¯ï¼Ÿ</h3>
                <strong>åŸå› ï¼š</strong> Cloudflareä½¿ç”¨ç‰¹å®šçš„Cookieè¿›è¡Œä¼šè¯ç®¡ç†å’Œå®‰å…¨éªŒè¯ï¼Œå¦‚æœCSPé…ç½®ä¸å®Œæ•´ï¼Œè¿™äº›Cookieä¼šè¢«æµè§ˆå™¨æ‹’ç»ã€‚<br>
                <strong>è§£å†³æ–¹æ¡ˆï¼š</strong> ç¡®ä¿CSPä¸­åŒ…å«æ‰€æœ‰å¿…è¦çš„CloudflareåŸŸåã€‚
            </div>

            <div class="important">
                <h3>â“ Notioné¡µé¢æ˜¾ç¤ºç©ºç™½æ€ä¹ˆåŠï¼Ÿ</h3>
                <strong>åŸå› ï¼š</strong> CSPé˜»æ­¢äº†å¿…è¦çš„èµ„æºåŠ è½½ã€‚<br>
                <strong>è§£å†³æ–¹æ¡ˆï¼š</strong> æ£€æŸ¥å¹¶æ›´æ–°CSPé…ç½®ï¼Œç¡®ä¿åŒ…å«æ‰€æœ‰Notionå’ŒCloudflareåŸŸåã€‚
            </div>

            <div class="important">
                <h3>â“ å¦‚ä½•éªŒè¯CSPé…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ</h3>
                <strong>æ–¹æ³•ï¼š</strong><br>
                1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·<br>
                2. æŸ¥çœ‹Consoleæ ‡ç­¾é¡µ<br>
                3. å¦‚æœæ²¡æœ‰CSPé”™è¯¯ï¼Œè¯´æ˜é…ç½®æ­£ç¡®<br>
                4. å¦‚æœæœ‰CSPé˜»æ­¢çš„é”™è¯¯ï¼Œéœ€è¦æ·»åŠ ç›¸åº”çš„åŸŸå
            </div>
        </div>

        <div class="section">
            <div class="question">ğŸ¯ æ€»ç»“ä¸å»ºè®®</div>
            <div class="answer">
                <strong>CSPå’ŒCloudflareçš„é›†æˆæ˜¯ç°ä»£Webåº”ç”¨å®‰å…¨æ€§çš„é‡è¦ç»„æˆéƒ¨åˆ†</strong>ã€‚è™½ç„¶ä¼šäº§ç”Ÿä¸€äº›é…ç½®å¤æ‚æ€§ï¼Œä½†å®ƒä¸ºæˆ‘ä»¬çš„åº”ç”¨æä¾›äº†é‡è¦çš„å®‰å…¨ä¿éšœã€‚
            </div>

            <div class="why-needed">
                <h3>âœ… å½“å‰é…ç½®çš„ä¼˜åŠ¿ï¼š</h3>
                â€¢ <strong>å®‰å…¨æ€§</strong> - é˜²æ­¢XSSå’Œä»£ç æ³¨å…¥æ”»å‡»<br>
                â€¢ <strong>åŠŸèƒ½å®Œæ•´æ€§</strong> - ç¡®ä¿Notioné¡µé¢æ­£å¸¸æ˜¾ç¤º<br>
                â€¢ <strong>æ€§èƒ½ä¼˜åŒ–</strong> - Cloudflare CDNåŠ é€Ÿèµ„æºåŠ è½½<br>
                â€¢ <strong>ä¼ä¸šçº§æ ‡å‡†</strong> - ç¬¦åˆç°ä»£Webå®‰å…¨è§„èŒƒ
            </div>

            <div class="important">
                <strong>ğŸ’¡ ç»´æŠ¤å»ºè®®ï¼š</strong><br>
                â€¢ å®šæœŸæ£€æŸ¥CSPé…ç½®æ˜¯å¦ä»ç„¶æœ‰æ•ˆ<br>
                â€¢ ç›‘æ§æµè§ˆå™¨æ§åˆ¶å°çš„CSPç›¸å…³é”™è¯¯<br>
                â€¢ åœ¨æ·»åŠ æ–°åŠŸèƒ½æ—¶åŠæ—¶æ›´æ–°CSPè§„åˆ™<br>
                â€¢ ä¿æŒä¸æœ€æ–°Webå®‰å…¨æ ‡å‡†çš„åŒæ­¥
            </div>
        </div>
    </div>
</body>
</html>

