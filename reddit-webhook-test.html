<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit Webhook æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #f6ffed; border-color: #b7eb8f; }
        .error { background-color: #fff2f0; border-color: #ffb3b3; }
        .info { background-color: #f0f9ff; border-color: #87ceeb; }
        button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #40a9ff; }
        pre {
            background: #f8f8f8;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Reddit Webhook ä¿®å¤æµ‹è¯•</h1>
        
        <div class="test-section info">
            <h3>ğŸ“‹ æµ‹è¯•æ¦‚è¿°</h3>
            <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•Redditå·¥ä½œæµwebhookè¿”å›ç»“æœçš„æ˜¾ç¤ºé—®é¢˜ä¿®å¤ã€‚</p>
            <p><strong>é—®é¢˜æè¿°ï¼š</strong> Reddit hot postså·¥ä½œæµæ— æ³•æ­£å¸¸æ˜¾ç¤ºwebhookè¿”å›ç»“æœ</p>
            <p><strong>ä¿®å¤å†…å®¹ï¼š</strong></p>
            <ul>
                <li>âœ… ç¡®è®¤webhookç«¯ç‚¹æ­£å¸¸å·¥ä½œ</li>
                <li>âœ… ä¿®å¤æ•°æ®æ ¼å¼è§£æé—®é¢˜</li>
                <li>âœ… æ·»åŠ æ–°çš„RedditWorkflowResponseæ•°æ®æ ¼å¼æ”¯æŒ</li>
                <li>âœ… ä¿®å¤å­—æ®µæ˜ å°„é”™è¯¯ï¼ˆupvotes/scoreï¼‰</li>
                <li>âœ… å®Œå–„æ•°æ®ä¼ é€’é“¾è·¯</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>ğŸŒ ç½‘ç»œè¿æ¥æµ‹è¯•</h3>
            <button onclick="testWebhookConnection()">æµ‹è¯•Webhookè¿æ¥</button>
            <div id="connectionResult"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“¡ æ•°æ®è·å–æµ‹è¯•</h3>
            <button onclick="fetchRedditData()">è·å–Redditæ•°æ®</button>
            <div id="dataResult"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ” æ•°æ®æ ¼å¼éªŒè¯</h3>
            <button onclick="validateDataFormat()">éªŒè¯æ•°æ®æ ¼å¼</button>
            <div id="formatResult"></div>
        </div>
    </div>

    <script>
        async function testWebhookConnection() {
            const resultDiv = document.getElementById('connectionResult');
            resultDiv.innerHTML = '<div class="status info">ğŸ”„ æ­£åœ¨æµ‹è¯•è¿æ¥...</div>';
            
            try {
                const response = await fetch('https://n8n.wendealai.com/webhook/reddithot', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="status success">
                            âœ… è¿æ¥æˆåŠŸï¼<br>
                            çŠ¶æ€ç : ${response.status}<br>
                            å†…å®¹ç±»å‹: ${response.headers.get('content-type')}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="status error">
                            âŒ è¿æ¥å¤±è´¥<br>
                            çŠ¶æ€ç : ${response.status}<br>
                            é”™è¯¯: ${response.statusText}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">
                        âŒ ç½‘ç»œé”™è¯¯: ${error.message}
                    </div>
                `;
            }
        }

        async function fetchRedditData() {
            const resultDiv = document.getElementById('dataResult');
            resultDiv.innerHTML = '<div class="status info">ğŸ”„ æ­£åœ¨è·å–Redditæ•°æ®...</div>';
            
            try {
                const response = await fetch('https://n8n.wendealai.com/webhook/reddithot', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('è·å–åˆ°çš„æ•°æ®:', data);
                    
                    resultDiv.innerHTML = `
                        <div class="status success">
                            âœ… æ•°æ®è·å–æˆåŠŸï¼<br>
                            æ•°æ®å¤§å°: ${JSON.stringify(data).length} å­—ç¬¦<br>
                            <details>
                                <summary>æŸ¥çœ‹åŸå§‹æ•°æ®</summary>
                                <pre>${JSON.stringify(data, null, 2)}</pre>
                            </details>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="status error">
                            âŒ æ•°æ®è·å–å¤±è´¥<br>
                            çŠ¶æ€ç : ${response.status}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">
                        âŒ è·å–é”™è¯¯: ${error.message}
                    </div>
                `;
            }
        }

        async function validateDataFormat() {
            const resultDiv = document.getElementById('formatResult');
            resultDiv.innerHTML = '<div class="status info">ğŸ”„ æ­£åœ¨éªŒè¯æ•°æ®æ ¼å¼...</div>';
            
            try {
                const response = await fetch('https://n8n.wendealai.com/webhook/reddithot', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // éªŒè¯æ–°çš„Redditå·¥ä½œæµæ•°æ®æ ¼å¼
                    const actualData = data.json || data;
                    const validations = [];
                    
                    // æ£€æŸ¥å¿…éœ€å­—æ®µ
                    if (actualData.success !== undefined) {
                        validations.push('âœ… success å­—æ®µå­˜åœ¨');
                    } else {
                        validations.push('âŒ success å­—æ®µç¼ºå¤±');
                    }
                    
                    if (actualData.headerInfo) {
                        validations.push('âœ… headerInfo å­—æ®µå­˜åœ¨');
                    } else {
                        validations.push('âŒ headerInfo å­—æ®µç¼ºå¤±');
                    }
                    
                    if (actualData.summary) {
                        validations.push('âœ… summary å­—æ®µå­˜åœ¨');
                    } else {
                        validations.push('âŒ summary å­—æ®µç¼ºå¤±');
                    }
                    
                    if (actualData.subreddits && Array.isArray(actualData.subreddits)) {
                        validations.push(`âœ… subreddits æ•°ç»„å­˜åœ¨ (${actualData.subreddits.length} ä¸ª)`);
                        
                        // éªŒè¯ç¬¬ä¸€ä¸ªsubredditçš„ç»“æ„
                        if (actualData.subreddits.length > 0) {
                            const firstSub = actualData.subreddits[0];
                            if (firstSub.name && firstSub.posts && Array.isArray(firstSub.posts)) {
                                validations.push(`âœ… å­ç‰ˆå—ç»“æ„æ­£ç¡® (${firstSub.posts.length} ä¸ªå¸–å­)`);
                                
                                // éªŒè¯ç¬¬ä¸€ä¸ªå¸–å­çš„ç»“æ„
                                if (firstSub.posts.length > 0) {
                                    const firstPost = firstSub.posts[0];
                                    const postFields = ['title', 'author', 'score', 'comments', 'url'];
                                    const missingFields = postFields.filter(field => !firstPost[field]);
                                    
                                    if (missingFields.length === 0) {
                                        validations.push('âœ… å¸–å­å­—æ®µå®Œæ•´');
                                    } else {
                                        validations.push(`âŒ å¸–å­ç¼ºå¤±å­—æ®µ: ${missingFields.join(', ')}`);
                                    }
                                }
                            } else {
                                validations.push('âŒ å­ç‰ˆå—ç»“æ„ä¸æ­£ç¡®');
                            }
                        }
                    } else {
                        validations.push('âŒ subreddits æ•°ç»„ç¼ºå¤±æˆ–æ ¼å¼é”™è¯¯');
                    }
                    
                    const allValid = validations.every(v => v.startsWith('âœ…'));
                    
                    resultDiv.innerHTML = `
                        <div class="status ${allValid ? 'success' : 'error'}">
                            ${allValid ? 'âœ… æ•°æ®æ ¼å¼éªŒè¯é€šè¿‡ï¼' : 'âš ï¸ æ•°æ®æ ¼å¼å­˜åœ¨é—®é¢˜'}
                            <ul>
                                ${validations.map(v => `<li>${v}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="status error">
                            âŒ æ— æ³•è·å–æ•°æ®è¿›è¡ŒéªŒè¯<br>
                            çŠ¶æ€ç : ${response.status}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">
                        âŒ éªŒè¯é”™è¯¯: ${error.message}
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºæœ¬æµ‹è¯•
        window.onload = function() {
            console.log('ğŸš€ Reddit Webhook ä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“‹ å¯ç”¨æµ‹è¯•ï¼š');
            console.log('  1. ç½‘ç»œè¿æ¥æµ‹è¯• - éªŒè¯webhookç«¯ç‚¹å¯è®¿é—®æ€§');
            console.log('  2. æ•°æ®è·å–æµ‹è¯• - è·å–å®Œæ•´çš„Redditæ•°æ®');
            console.log('  3. æ•°æ®æ ¼å¼éªŒè¯ - éªŒè¯æ–°æ•°æ®æ ¼å¼çš„å®Œæ•´æ€§');
            console.log('');
            console.log('ğŸ’¡ å»ºè®®æµ‹è¯•é¡ºåºï¼šè¿æ¥ â†’ è·å– â†’ éªŒè¯');
        };
    </script>
</body>
</html>



