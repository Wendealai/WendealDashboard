# å°çº¢ä¹¦ä¸»é¢˜ç”Ÿæˆå·¥ä½œæµéƒ¨ç½²æŒ‡å—

## ğŸ“¦ æ–‡ä»¶æ¸…å•

æ‚¨ç°åœ¨æœ‰3ä¸ªç‹¬ç«‹çš„ n8n å·¥ä½œæµ JSON æ–‡ä»¶ï¼š

1. **workflow1-submit-task.json** - æäº¤ä»»åŠ¡å·¥ä½œæµ
2. **workflow2-process-task.json** - å¤„ç†ä»»åŠ¡å·¥ä½œæµ
3. **workflow3-query-status.json** - æŸ¥è¯¢çŠ¶æ€å·¥ä½œæµ

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1ï¼šå¯¼å…¥å·¥ä½œæµ 2ï¼ˆå¤„ç†ä»»åŠ¡ï¼‰

> âš ï¸ **é‡è¦**ï¼šå¿…é¡»å…ˆå¯¼å…¥å·¥ä½œæµ 2ï¼Œå› ä¸ºå·¥ä½œæµ 1 éœ€è¦å¼•ç”¨å®ƒçš„ ID

1. ç™»å½• n8nï¼š`https://n8n.wendealai.com`
2. ç‚¹å‡» **"Workflows"** â†’ **"Import from File"**
3. é€‰æ‹© `workflows/workflow2-process-task.json`
4. ç‚¹å‡» **"Import"**
5. **æ¿€æ´»å·¥ä½œæµ**ï¼ˆå³ä¸Šè§’å¼€å…³ï¼‰
6. **å¤åˆ¶å·¥ä½œæµ ID**ï¼ˆURL ä¸­çš„ IDï¼Œä¾‹å¦‚ï¼š`https://n8n.wendealai.com/workflow/ABC123DEF456`ï¼ŒID ä¸º `ABC123DEF456`ï¼‰

---

### æ­¥éª¤ 2ï¼šé…ç½®å·¥ä½œæµ 1ï¼ˆæäº¤ä»»åŠ¡ï¼‰

1. ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ `workflows/workflow1-submit-task.json`
2. æ‰¾åˆ°è¿™ä¸€è¡Œï¼š
   ```json
   "workflowId": "REPLACE_WITH_WORKFLOW2_ID",
   ```
3. å°† `REPLACE_WITH_WORKFLOW2_ID` æ›¿æ¢ä¸ºæ­¥éª¤ 1 ä¸­å¤åˆ¶çš„å·¥ä½œæµ 2 çš„ ID
4. ä¿å­˜æ–‡ä»¶

---

### æ­¥éª¤ 3ï¼šå¯¼å…¥å·¥ä½œæµ 1ï¼ˆæäº¤ä»»åŠ¡ï¼‰

1. åœ¨ n8n ä¸­ç‚¹å‡» **"Import from File"**
2. é€‰æ‹©ä¿®æ”¹åçš„ `workflows/workflow1-submit-task.json`
3. ç‚¹å‡» **"Import"**
4. **éªŒè¯ Execute Workflow èŠ‚ç‚¹**ï¼š
   - æ‰“å¼€ "Trigger Processing Workflow" èŠ‚ç‚¹
   - ç¡®è®¤ "Workflow ID" å­—æ®µæ˜¾ç¤ºå·¥ä½œæµ 2 çš„åç§°
5. **æ¿€æ´»å·¥ä½œæµ**

---

### æ­¥éª¤ 4ï¼šå¯¼å…¥å·¥ä½œæµ 3ï¼ˆæŸ¥è¯¢çŠ¶æ€ï¼‰

1. åœ¨ n8n ä¸­ç‚¹å‡» **"Import from File"**
2. é€‰æ‹© `workflows/workflow3-query-status.json`
3. ç‚¹å‡» **"Import"**
4. **æ¿€æ´»å·¥ä½œæµ**

---

### æ­¥éª¤ 5ï¼šéªŒè¯ n8n Table Database

ç¡®è®¤ `rednote_subject_tasks` è¡¨å·²å­˜åœ¨å¹¶åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

| å­—æ®µå        | ç±»å‹     | è¯´æ˜                                          |
| ------------- | -------- | --------------------------------------------- |
| `taskId`      | String   | ä»»åŠ¡å”¯ä¸€æ ‡è¯†                                  |
| `subject`     | String   | ç”¨æˆ·è¾“å…¥çš„ä¸»é¢˜                                |
| `status`      | String   | ä»»åŠ¡çŠ¶æ€ï¼špending/processing/completed/failed |
| `result`      | String   | AI ç”Ÿæˆçš„ç»“æœï¼ˆJSON å­—ç¬¦ä¸²ï¼‰                  |
| `error`       | String   | é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœå¤±è´¥ï¼‰                          |
| `createdAt`   | DateTime | åˆ›å»ºæ—¶é—´                                      |
| `startedAt`   | DateTime | å¼€å§‹å¤„ç†æ—¶é—´                                  |
| `completedAt` | DateTime | å®Œæˆæ—¶é—´                                      |
| `duration`    | Number   | å¤„ç†è€—æ—¶ï¼ˆç§’ï¼‰                                |

**å¦‚æœè¡¨ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–¹æ³•ï¼š**

1. åœ¨ n8n ä¸­æ‰“å¼€ä»»ä¸€å·¥ä½œæµ
2. æ·»åŠ  **Data Table** èŠ‚ç‚¹
3. é€‰æ‹© **"Create"** æ“ä½œ
4. è¾“å…¥è¡¨åï¼š`rednote_subject_tasks`
5. æ·»åŠ ä¸Šè¿°å­—æ®µ
6. æ‰§è¡Œä¸€æ¬¡ä»¥åˆ›å»ºè¡¨

---

## ğŸ”— Webhook URL æ±‡æ€»

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å°†æ‹¥æœ‰3ä¸ª webhook URLï¼š

### 1. æäº¤ä»»åŠ¡ï¼ˆå‰ç«¯è°ƒç”¨ï¼‰

```
POST https://n8n.wendealai.com/webhook/rednotesubject
```

**è¯·æ±‚ä½“ï¼š**

```json
{
  "subject": "éš”ä»£è‚²å„¿å†²çªæ—¶çš„æ­£ç¡®æ²Ÿé€šæ–¹å¼",
  "timestamp": "2025-10-30T10:00:00Z"
}
```

**å“åº”ï¼š**

```json
{
  "taskId": "task_1730275200000_abc123",
  "subject": "éš”ä»£è‚²å„¿å†²çªæ—¶çš„æ­£ç¡®æ²Ÿé€šæ–¹å¼",
  "status": "pending",
  "createdAt": "2025-10-30T10:00:00.000Z",
  "timestamp": "2025-10-30T10:00:00Z"
}
```

---

### 2. æŸ¥è¯¢çŠ¶æ€ï¼ˆå‰ç«¯è½®è¯¢ï¼‰

```
GET https://n8n.wendealai.com/webhook/task-status/{taskId}
```

**å“åº”ç¤ºä¾‹ï¼ˆpendingï¼‰ï¼š**

```json
{
  "taskId": "task_1730275200000_abc123",
  "status": "pending",
  "message": "Task is waiting to be processed",
  "createdAt": "2025-10-30T10:00:00.000Z"
}
```

**å“åº”ç¤ºä¾‹ï¼ˆprocessingï¼‰ï¼š**

```json
{
  "taskId": "task_1730275200000_abc123",
  "status": "processing",
  "message": "Task is being processed by AI",
  "elapsedTime": "45s",
  "createdAt": "2025-10-30T10:00:00.000Z"
}
```

**å“åº”ç¤ºä¾‹ï¼ˆcompletedï¼‰ï¼š**

```json
{
  "taskId": "task_1730275200000_abc123",
  "status": "completed",
  "result": {
    "title": "éš”ä»£è‚²å„¿çš„5ä¸ªæ²Ÿé€šé»„é‡‘æ³•åˆ™ï¼Œè®©å©†åª³å…³ç³»æ›´å’Œè°",
    "alternativeTitles": [
      "ä¸å†åµæ¶ï¼éš”ä»£è‚²å„¿çš„æ²Ÿé€šæŠ€å·§å…¨æ”»ç•¥",
      "å©†å©†å¸¦å¨ƒä½ ä¸æ”¾å¿ƒï¼Ÿè¿™æ ·æ²Ÿé€šæ‰æœ‰æ•ˆ"
    ],
    "content": "...",
    "suggestions": ["...", "...", "..."],
    "tags": ["è‚²å„¿", "éš”ä»£è‚²å„¿", "å©†åª³å…³ç³»"],
    "fullReport": "...",
    "generatedAt": "2025-10-30T10:02:30.000Z",
    "wordCount": 3500
  },
  "completedAt": "2025-10-30T10:02:30.000Z",
  "duration": 150
}
```

**å“åº”ç¤ºä¾‹ï¼ˆfailedï¼‰ï¼š**

```json
{
  "taskId": "task_1730275200000_abc123",
  "status": "failed",
  "error": "AI model timeout",
  "completedAt": "2025-10-30T10:05:00.000Z"
}
```

---

### 3. å¤„ç†ä»»åŠ¡ï¼ˆç”±å·¥ä½œæµ 1 è‡ªåŠ¨è§¦å‘ï¼‰

æ­¤å·¥ä½œæµé€šè¿‡ **Execute Workflow** èŠ‚ç‚¹è§¦å‘ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ã€‚

---

## âœ… æµ‹è¯•éªŒè¯

### æµ‹è¯• 1ï¼šæäº¤ä»»åŠ¡

```bash
curl -X POST https://n8n.wendealai.com/webhook/rednotesubject \
  -H "Content-Type: application/json" \
  -d '{
    "subject": "æµ‹è¯•ä¸»é¢˜",
    "timestamp": "2025-10-30T10:00:00Z"
  }'
```

**é¢„æœŸç»“æœ**ï¼š

- ç«‹å³è¿”å› taskIdï¼ˆå“åº”æ—¶é—´ < 1ç§’ï¼‰
- æ•°æ®åº“ä¸­æ–°å¢ä¸€æ¡ status=pending çš„è®°å½•

---

### æµ‹è¯• 2ï¼šæŸ¥è¯¢çŠ¶æ€ï¼ˆpendingï¼‰

```bash
# å°† {taskId} æ›¿æ¢ä¸ºæ­¥éª¤ 1 è¿”å›çš„ taskId
curl -X GET https://n8n.wendealai.com/webhook/task-status/{taskId}
```

**é¢„æœŸç»“æœ**ï¼š

- è¿”å› `status: "pending"` æˆ– `status: "processing"`

---

### æµ‹è¯• 3ï¼šç­‰å¾…å®Œæˆå¹¶å†æ¬¡æŸ¥è¯¢

```bash
# ç­‰å¾… 2-5 åˆ†é’Ÿåå†æ¬¡æŸ¥è¯¢
curl -X GET https://n8n.wendealai.com/webhook/task-status/{taskId}
```

**é¢„æœŸç»“æœ**ï¼š

- è¿”å› `status: "completed"` åŠå®Œæ•´ result æ•°æ®

---

## ğŸ” è°ƒè¯•å·¥å…·

### 1. æŸ¥çœ‹å·¥ä½œæµæ‰§è¡Œæ—¥å¿—

1. åœ¨ n8n ä¸­æ‰“å¼€ä»»ä¸€å·¥ä½œæµ
2. ç‚¹å‡»å³ä¾§ **"Executions"** æ ‡ç­¾
3. æŸ¥çœ‹æœ€è¿‘çš„æ‰§è¡Œè®°å½•
4. ç‚¹å‡»æŸæ¡è®°å½•æŸ¥çœ‹è¯¦ç»†æ•°æ®æµ

### 2. æŸ¥çœ‹æ•°æ®åº“å†…å®¹

1. åœ¨ä»»ä¸€å·¥ä½œæµä¸­æ·»åŠ ä¸´æ—¶çš„ **Data Table** èŠ‚ç‚¹
2. æ“ä½œé€‰æ‹© **"Get"**
3. ç­›é€‰æ¡ä»¶ç•™ç©ºï¼ˆè·å–æ‰€æœ‰è®°å½•ï¼‰
4. æ‰‹åŠ¨æ‰§è¡ŒæŸ¥çœ‹æ•°æ®

### 3. ç›‘æ§å·¥å…·

æ¨èåœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­è§‚å¯Ÿï¼š

- Network æ ‡ç­¾ï¼šæŸ¥çœ‹è¯·æ±‚/å“åº”
- Console æ ‡ç­¾ï¼šæŸ¥çœ‹å‰ç«¯æ—¥å¿—

---

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šå·¥ä½œæµ 1 æ— æ³•è§¦å‘å·¥ä½œæµ 2

**åŸå› **ï¼šExecute Workflow èŠ‚ç‚¹é…ç½®é”™è¯¯

**è§£å†³**ï¼š

1. æ£€æŸ¥å·¥ä½œæµ 2 çš„ ID æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤å·¥ä½œæµ 2 å·²æ¿€æ´»
3. æ£€æŸ¥å·¥ä½œæµ 2 çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸º `Execute Workflow Trigger`

---

### é—®é¢˜ 2ï¼šæŸ¥è¯¢çŠ¶æ€æ—¶è¿”å› 404

**åŸå› **ï¼šWebhook è·¯å¾„é…ç½®é”™è¯¯æˆ–å·¥ä½œæµæœªæ¿€æ´»

**è§£å†³**ï¼š

1. ç¡®è®¤å·¥ä½œæµ 3 å·²æ¿€æ´»
2. æ£€æŸ¥ Webhook èŠ‚ç‚¹çš„ path é…ç½®ä¸º `task-status/:taskId`
3. ç¡®è®¤ URL æ ¼å¼æ­£ç¡®ï¼š`/webhook/task-status/{taskId}`

---

### é—®é¢˜ 3ï¼šçŠ¶æ€ä¸€ç›´æ˜¯ pending

**åŸå› **ï¼šå·¥ä½œæµ 2 æœªè¢«è§¦å‘æˆ–æ‰§è¡Œå¤±è´¥

**è§£å†³**ï¼š

1. æŸ¥çœ‹å·¥ä½œæµ 2 çš„æ‰§è¡Œæ—¥å¿—
2. æ£€æŸ¥å·¥ä½œæµ 1 çš„ Execute Workflow èŠ‚ç‚¹æ˜¯å¦æ‰§è¡ŒæˆåŠŸ
3. ç¡®è®¤ AI Agent çš„å‡­æ®é…ç½®æ­£ç¡®

---

### é—®é¢˜ 4ï¼šAI Agent æ‰§è¡Œè¶…æ—¶

**åŸå› **ï¼šAI æ¨¡å‹å“åº”è¿‡æ…¢

**è§£å†³**ï¼š

1. æ£€æŸ¥ AI æ¨¡å‹çš„ API é…é¢å’Œé™åˆ¶
2. å°è¯•åˆ‡æ¢åˆ°æ›´å¿«çš„æ¨¡å‹ï¼ˆDeepSeek é€šå¸¸æ¯” GPT-4 å¿«ï¼‰
3. è°ƒæ•´ system message é•¿åº¦ï¼Œå‡å°‘ä¸å¿…è¦çš„æç¤ºè¯

---

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

å»ºè®®ç›‘æ§ä»¥ä¸‹æŒ‡æ ‡ä»¥ç¡®ä¿ç³»ç»Ÿæ­£å¸¸è¿è¡Œï¼š

| æŒ‡æ ‡             | å¥åº·å€¼   | è¯´æ˜                      |
| ---------------- | -------- | ------------------------- |
| æäº¤ä»»åŠ¡å“åº”æ—¶é—´ | < 1ç§’    | å·¥ä½œæµ 1 çš„å“åº”é€Ÿåº¦       |
| ä»»åŠ¡å¤„ç†æ—¶é•¿     | 30-180ç§’ | å·¥ä½œæµ 2 çš„æ‰§è¡Œæ—¶é•¿       |
| æŸ¥è¯¢çŠ¶æ€å“åº”æ—¶é—´ | < 0.5ç§’  | å·¥ä½œæµ 3 çš„å“åº”é€Ÿåº¦       |
| ä»»åŠ¡å¤±è´¥ç‡       | < 5%     | éœ€è¦è°ƒæŸ¥å¤±è´¥åŸå›           |
| pending ä»»åŠ¡ç§¯å‹ | < 10     | æ£€æŸ¥å·¥ä½œæµ 2 æ˜¯å¦æ­£å¸¸è§¦å‘ |

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **é›†æˆåˆ°å‰ç«¯**ï¼šæ›´æ–° `RedNoteContentGenerator.tsx` ä¸­çš„ webhook URL
2. **æ·»åŠ æ—¥å¿—**ï¼šåœ¨å…³é”®èŠ‚ç‚¹æ·»åŠ æ—¥å¿—è¾“å‡ºä¾¿äºè°ƒè¯•
3. **é…ç½®å‘Šè­¦**ï¼šåœ¨ n8n ä¸­é…ç½®å¤±è´¥ä»»åŠ¡çš„é‚®ä»¶/Slack é€šçŸ¥
4. **ä¼˜åŒ–æ€§èƒ½**ï¼šæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´ AI prompt å’Œè½®è¯¢é—´éš”
5. **æ•°æ®å¤‡ä»½**ï¼šå®šæœŸå¯¼å‡º n8n Table Database æ•°æ®

---

## ğŸ“ æ€»ç»“

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å°†æ‹¥æœ‰ï¼š

âœ… **çœŸæ­£çš„å¼‚æ­¥å¤„ç†**ï¼šå‰ç«¯ç«‹å³å“åº”ï¼Œåå°å¤„ç†
âœ… **å¯é çš„çŠ¶æ€æŸ¥è¯¢**ï¼šç²¾ç¡®è·å–ä»»åŠ¡çŠ¶æ€å’Œç»“æœ  
âœ… **å®Œå–„çš„é”™è¯¯å¤„ç†**ï¼šå¤±è´¥ä»»åŠ¡è‡ªåŠ¨æ ‡è®°
âœ… **ç‹¬ç«‹çš„å·¥ä½œæµ**ï¼šæ˜“äºç»´æŠ¤å’Œæ‰©å±•
âœ… **çµæ´»çš„æ¶æ„**ï¼šå¯éšæ—¶ä¼˜åŒ–å•ä¸ªå·¥ä½œæµ

---

## ğŸ†˜ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ï¼š

1. å…·ä½“çš„é”™è¯¯ä¿¡æ¯
2. n8n æ‰§è¡Œæ—¥å¿—æˆªå›¾
3. è¯·æ±‚/å“åº”çš„å®Œæ•´æ•°æ®
4. å·¥ä½œæµé…ç½®æˆªå›¾

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸš€
